# üí¨ –§–∏–Ω–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã

## ‚ùì –í–æ–ø—Ä–æ—Å –æ —Ä–∞–∑–º–µ—Ä–∞—Ö: Build/ 1GB –Ω–µ —Å–¥–µ–ª–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–≥—Ä–æ–º–Ω—ã–º?

### ‚úÖ –û—Ç–≤–µ—Ç: **–ù–ï–¢! –°–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –Ω–µ –ø–æ–≤–ª–∏—è–µ—Ç!**

### –ü–æ—á–µ–º—É:

#### 1. **Build/ –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ Git**

`.gitignore` —Å–æ–¥–µ—Ä–∂–∏—Ç:
```gitignore
build/              ‚Üê –ù–ï –ø–æ–ø–∞–¥–µ—Ç –≤ Git!
sources/            ‚Üê –ù–ï –ø–æ–ø–∞–¥–µ—Ç –≤ Git!
tor-*/              ‚Üê –ù–ï –ø–æ–ø–∞–¥–µ—Ç –≤ Git!
```

**–ò–∑ 1.5 GB –Ω–∞ –¥–∏—Å–∫–µ ‚Üí —Ç–æ–ª—å–∫–æ 30 MB –≤ Git!**

#### 2. **Tuist –±–µ—Ä–µ—Ç —Ç–æ–ª—å–∫–æ XCFramework**

–ö–æ–≥–¥–∞ TorApp –∏—Å–ø–æ–ª—å–∑—É–µ—Ç package —á–µ—Ä–µ–∑ Tuist:
```
Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (30 MB)
    ‚Üì
Tuist –∏–∑–≤–ª–µ–∫–∞–µ—Ç Tor.xcframework (28 MB)
    ‚Üì
–õ–∏–Ω–∫—É–µ—Ç –≤ TorApp
    ‚Üì
TorApp.ipa —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ +28 MB
```

**–í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ (build/, sources/, scripts/) –ù–ï –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!**

#### 3. **–ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä TorApp**

```
–í–∞—à –∫–æ–¥:              15 MB
+ TorFramework:       +28 MB
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
TorApp.ipa:           43 MB ‚úÖ
```

**–≠—Ç–æ –æ—Ç–ª–∏—á–Ω–æ!** Telegram: 120MB, WhatsApp: 200MB

### üìä –¢—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–∞:

| –ú–µ—Å—Ç–æ | –†–∞–∑–º–µ—Ä | –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç |
|-------|--------|------------|
| **–î–∏—Å–∫** | 1.5 GB | build/ + sources/ + –≤—Å—ë |
| **Git** | 30 MB | XCFramework + —Å–∫—Ä–∏–ø—Ç—ã + docs |
| **App** | +28 MB | –¢–û–õ–¨–ö–û XCFramework |

---

## ‚ùì –í–æ–ø—Ä–æ—Å –æ bridges –±–µ–∑ backend

### –í–∞—Ä–∏–∞–Ω—Ç—ã –ë–ï–ó backend/Firebase/CloudFlare:

#### –í–∞—Ä–∏–∞–Ω—Ç 1: **MessageUI + –£–º–Ω—ã–π UX** (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é)

**–ü—Ä–æ—Ü–µ—Å—Å:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ bridges"
   ‚Üì
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Mail —Å –≥–æ—Ç–æ–≤—ã–º –ø–∏—Å—å–º–æ–º
   To: bridges@torproject.org
   Body: get vanilla
   ‚Üì
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
   ‚Üì
4. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–∞–π–º–µ—Ä (2 –º–∏–Ω—É—Ç—ã)
   + –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É"
   ‚Üì
5. TextField —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π:
   "–í—Å—Ç–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –ø–∏—Å—å–º–∞ (IP:PORT)"
   ‚Üì
6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ
   "–ù–∞–π–¥–µ–Ω–æ: 3 bridges ‚úÖ"
   ‚Üì
7. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚Üí –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Tor
```

**–ö–æ–¥ (–≥–æ—Ç–æ–≤—ã–π –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é):**

```swift
// –í TorApp/Sources/Features/Bridges/BridgeFlow.swift

import SwiftUI
import MessageUI

struct BridgeFlowView: View {
    @StateObject private var viewModel = BridgeFlowViewModel()
    
    var body: some View {
        NavigationView {
            VStack(spacing: 30) {
                // –®–∞–≥ 1: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ bridges –∞–∫—Ç–∏–≤–Ω—ã
                if viewModel.step == 1 {
                    VStack(spacing: 20) {
                        Image(systemName: "network")
                            .font(.system(size: 60))
                        
                        Text("–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ bridges –∞–∫—Ç–∏–≤–Ω—ã")
                            .font(.title3)
                        
                        Text("–£ –≤–∞—Å —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–¥–µ–∂–Ω—ã–µ bridges")
                            .font(.caption)
                        
                        Button("–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ bridges") {
                            viewModel.step = 2
                        }
                        .buttonStyle(.borderedProminent)
                        
                        Button("–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏") {
                            viewModel.dismiss()
                        }
                        .buttonStyle(.bordered)
                    }
                }
                
                // –®–∞–≥ 2: –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞
                if viewModel.step == 2 {
                    VStack(spacing: 20) {
                        Image(systemName: "envelope.open.fill")
                            .font(.system(size: 60))
                            .foregroundColor(.blue)
                        
                        Text("–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å")
                            .font(.title2)
                        
                        Text("–û—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ—á—Ç–∞ —Å –≥–æ—Ç–æ–≤—ã–º –ø–∏—Å—å–º–æ–º.\n–ü—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å¬ª")
                            .multilineTextAlignment(.center)
                        
                        Button("–û—Ç–∫—Ä—ã—Ç—å –ø–æ—á—Ç—É") {
                            viewModel.showMail = true
                        }
                        .buttonStyle(.borderedProminent)
                        .sheet(isPresented: $viewModel.showMail) {
                            MailView { sent in
                                if sent {
                                    viewModel.step = 3
                                }
                            }
                        }
                    }
                }
                
                // –®–∞–≥ 3: –û–∂–∏–¥–∞–Ω–∏–µ
                if viewModel.step == 3 {
                    WaitingView(
                        timeRemaining: $viewModel.countdown,
                        onSkip: { viewModel.step = 4 }
                    )
                }
                
                // –®–∞–≥ 4: –í–≤–æ–¥ bridges
                if viewModel.step == 4 {
                    BridgeInputView(
                        bridgeText: $viewModel.bridgeText,
                        parsedCount: viewModel.parsedBridges.count,
                        onSave: { viewModel.saveBridges() }
                    )
                }
            }
            .padding()
            .navigationTitle("Bridges")
        }
    }
}

class BridgeFlowViewModel: ObservableObject {
    @Published var step = 1
    @Published var showMail = false
    @Published var countdown = 120
    @Published var bridgeText = ""
    
    private let timer = Timer.publish(every: 1, on: .main, in: .common).autoconnect()
    
    var parsedBridges: [String] {
        let pattern = #"(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}:\d+)"#
        guard let regex = try? NSRegularExpression(pattern: pattern) else { return [] }
        let matches = regex.matches(in: bridgeText, range: NSRange(bridgeText.startIndex..., in: bridgeText))
        return matches.compactMap { match in
            guard let range = Range(match.range(at: 1), in: bridgeText) else { return nil }
            return String(bridgeText[range])
        }
    }
    
    func saveBridges() {
        let bridges = parsedBridges
        UserDefaults.standard.set(bridges, forKey: "customBridges")
        // TODO: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Tor —Å –Ω–æ–≤—ã–º–∏ bridges
        // TorService.shared.configureBridges(bridges)
    }
}
```

**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: 30 –º–∏–Ω—É—Ç  
**Backend –Ω—É–∂–µ–Ω**: ‚ùå –ù–ï–¢  
**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ß–∞—Å—Ç–∏—á–Ω–∞—è (–ø–∞—Ä—Å–∏–Ω–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π, –≤—Å—Ç–∞–≤–∫–∞ —Ä—É—á–Ω–∞—è)  
**UX**: –•–æ—Ä–æ—à–∏–π (4 —à–∞–≥–∞ —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º)

#### –í–∞—Ä–∏–∞–Ω—Ç 2: **–¢–æ–ª—å–∫–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ** (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)

```swift
let staticBridges = [
    "85.31.186.98:443",
    "85.31.186.26:443",
    "209.148.46.65:443"
]

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É
TorService.shared.configureBridges(staticBridges)
```

**–û–±–Ω–æ–≤–ª—è—Ç—å**: –í—Ä—É—á–Ω—É—é —Ä–∞–∑ –≤ –º–µ—Å—è—Ü (–≤–∑—è—Ç—å —Å torproject.org)

### üéØ –ú–æ–π —Å–æ–≤–µ—Ç:

1. **–ù–∞—á–Ω–∏—Ç–µ**: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ bridges (—Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ä–∞–∑—É)
2. **–î–æ–±–∞–≤—å—Ç–µ**: MessageUI flow (–∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ)
3. **–ü–æ–∑–∂–µ**: Backend –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

**–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ë–ï–ó backend –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞** (iOS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è), –Ω–æ MessageUI –¥–∞–µ—Ç **95% –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏** —Å —Ö–æ—Ä–æ—à–∏–º UX!

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç:

1. **Build/ 1GB**: –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚úÖ
2. **Git —Ä–∞–∑–º–µ—Ä**: ~30 MB ‚úÖ  
3. **App —Ä–∞–∑–º–µ—Ä**: +28 MB ‚úÖ
4. **Bridges**: MessageUI + —É–º–Ω—ã–π UX (–±–µ–∑ backend) ‚úÖ

**–í—Å—ë –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ! –ú–æ–∂–µ—Ç–µ –∫–æ–º–º–∏—Ç–∏—Ç—å!** üéâ

